---
slug: translate-overwatch-architecture-netcode
date: 2025-10-18
tags: [overwatch, translate]
enableComments: true
---

# [ç¿»è¯‘] Overwatch Gameplay Architecture and Netcode

2017å¹´æš´é›ªåœ¨GDCçš„å…³äºå®ˆæœ›å…ˆé”‹æ¸¸æˆæ¶æ„å’Œç½‘ç»œè®¾è®¡çš„[æ¼”è®²](https://www.youtube.com/watch?v=Ks98kE3cs30)æ‘˜è¦ã€‚

<!-- truncate -->

æœ¬ç¯‡åšå®¢æ‰€å¤„çš„2025å¹´ï¼Œè™½ç„¶OW2ä¸æ–­æ›´æ–°ï¼Œç¤¾åŒºä¹Ÿèƒ½æ„Ÿåˆ°OW2è¶Šæ¥è¶Šå¥½ï¼Œä½†æèµ·OW1ï¼Œæ€»æ˜¯å¸¦æœ‰ç€ç¾å¥½çš„æ»¤é•œï¼ŒOW1çš„ä¸€ç³»åˆ—åˆ›ä¸¾ï¼Œå¦‚å›æ”¾ã€åœ°å›¾å·¥åŠä»¥åŠç¤¾åŒºæ™®éå¥½è¯„çš„ä»£ç æ°´å¹³ï¼ˆå³å½±å“æ¸¸æˆä½“éªŒçš„bugè¾ƒå°‘ã€ä¼˜åŒ–è¾ƒå¥½ã€‚ä½†bugä¸æ˜¯æ²¡æœ‰ï¼Œæ¯”å¦‚è‘—åçš„å°é”¤é»„ç”²bugï¼‰ï¼Œè®©æˆ‘è¿™ä¸ªOW2å…¥å‘çš„ç©å®¶ååˆ†æœ‰å…´è¶£ã€‚

å›½å†…è™½ç„¶ä¹Ÿæœ‰[æ¬è¿](https://gwb.tencent.com/community/detail/114516)ï¼Œä½†å›¾ç‰‡ç¼ºå¤±ä¸”ç¼ºä¹ç»´æŠ¤ï¼Œä¸”ç¿»è¯‘å¤ªè¿‡å†—é•¿ã€‚è¯¥ä»æ•…çº¸å †ä¸­æ‹¾èµ·æ¥äº†ã€‚

æœ¬æ–‡ä¸»è¦å‚è€ƒï¼š

1. [è…¾è®¯GWBç¤¾åŒºç¿»è¯‘](https://gwb.tencent.com/community/detail/114516)
2. [YoutubeåŸè§†é¢‘](https://www.youtube.com/watch?v=Ks98kE3cs30)

## ECS

å®ˆæœ›å…ˆé”‹é‡‡ç”¨äº†ECSï¼ˆEntity-Component-Systemï¼‰æ¶æ„ï¼Œä¸åŒäºå…¶ä»–å¼•æ“ä¸­æµè¡Œçš„Component modelå’ŒActor modelã€‚é€‰æ‹©ECSæœ¬èº«çš„åŸå› å¯èƒ½å¸¦ç€å›¢é˜Ÿçš„æ„Ÿæƒ…å› ç´ ï¼Œä½†ä»äº‹åè¯¸è‘›äº®çš„è§’åº¦è€Œè¨€ï¼ŒECSèƒ½å¤Ÿå¾ˆå¥½çš„ç®¡ç†ä»£ç å¢é•¿å¸¦æ¥çš„å¤æ‚æ€§ã€‚

```mermaid
graph RL

System --> World
SystemA --> System
SystemB --> System
SystemC --> System
Entity --> World
Component --> Entity
ComponentA --> Component
ComponentB --> 
Component
Componentc --> 
Component
```

ä¸Šå›¾ä¸­ï¼ŒWorldä»…ä¸ºSystemå’ŒEntityçš„é›†åˆï¼ŒEntityä»…ä¸ºä¸€ä¸ªå¯¹åº”Component é›†åˆçš„IDï¼ŒComponentå­˜å‚¨æ¸¸æˆçš„çŠ¶æ€(state)è€Œä¸åŒ…å«è¡Œä¸º(behavior)ï¼Œè€ŒSystemåè¿‡æ¥ã€‚

æ‰€ä»¥ï¼Œ**Componentæ²¡æœ‰Behavior(function)ï¼ŒSystemæ²¡æœ‰State(field)ã€‚**

![ECS Example](ecs_example.png)

> 2017 å¹´çš„è§†é¢‘ï¼Œæ²¡æœ‰é«˜æ¸…æ

å·¦è¾¹è½®è¯¢éå†Systemï¼Œå•ä¸ªSystemç»‘å®šå¤šä¸ªComponent(tuple of Components)ï¼Œåœ¨Componentä¸Šè¿›è¡Œæ“ä½œï¼ˆå³Behaviorï¼‰ã€‚

### Example: Physics system prototype

![Prototype Example](physics_prototype_example.png)

ä¸Šå›¾å³ECSä¸­ä¸€ä¸ªtickè½®è¯¢çš„ä¾‹å­ï¼š

å…¶æ‰§è¡Œå†…éƒ¨ç‰©ç†å¼•æ“çš„æ›´æ–°ã€‚ç‰©ç†å¼•æ“å¯ä»¥æ˜¯Box2Dï¼ˆ2Dç‰©ç†å¼•æ“ï¼‰æˆ–è€…Dominoï¼ˆæš´é›ªè‡ªç ”ï¼‰ã€‚æ‰§è¡Œå®Œæ¨¡æ‹Ÿåï¼Œéå†tupleï¼Œç”¨DynamicPhysicsComponentä¸­çš„proxyæå–é‡Œé¢çš„ç‰©ç†è¡¨ç¤ºï¼Œå¤åˆ¶ç»™Transform Componentå’ŒContact Componentï¼ˆç¢°æ’Componentï¼‰ã€‚

Systemå¯¹å•ä¸ªComponentæ˜¯æ— å…³å¿ƒçš„ï¼Œå…¶å¯¹tupleä¸­çš„sliceè¿›è¡Œä¸€ç»„æ“ä½œï¼ˆBehaviorï¼‰ã€‚

### Overwatch ECS

æŠŠä¸Šé¢çš„ECSå›¾æ¬æ¥ç»™å®ˆæœ›å…ˆé”‹ï¼Œä¾¿æœ‰ä»¥ä¸‹æ¶æ„ï¼š

```mermaid
graph RL

System --> 1["EntityAdmin(World)"]
SystemA --> System
SystemB --> System
SystemC --> System
Entity --> 1
Component --> Entity
ComponentA --> Component
ComponentB --> 
Component
Componentc --> 
Component
```

å…¶ä¸­`EntityAdmin`åŒ…å«ä¸€ä¸ª`Array<System>`ã€ä¸€ä¸ª`Entity hashmap<Entity ID, Entity>`ï¼Œå…¶ä¸­`Entity`å­˜å‚¨`Entity ID`åŠå¯é€‰çš„resource handlerï¼ŒæŒ‡å‘Entityå®é™…çš„Assetèµ„æºã€‚

Componentä¸ºåŸºç±»ï¼Œæ´¾ç”Ÿå‡ºæ•°ç™¾ä¸ªsub-Componentã€‚åœ¨è¿™é‡Œï¼Œå¤šæ€æ€§å”¯ä¸€çš„ç”¨å¤„åœ¨äºç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼ˆå¦‚Create Destroyï¼‰ï¼Œå› ä¸ºComponentæ²¡æœ‰Behaviorï¼Œæ— éœ€å…³æ³¨å…·ä½“çš„æ“ä½œå‡½æ•°ã€‚

å®é™…çš„å®ˆæœ›å…ˆé”‹ä¸­ï¼Œæœ‰çš„Systeméœ€è¦å•ä¸ªComponentï¼Œæœ‰çš„éœ€è¦å°†è¿‘ä¸€åŠçš„Componentã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå›¢é˜Ÿå¸Œæœ›æ¯ä¸ªSysteméƒ½ä¾èµ–å¾ˆå¤šComponentæ‰§è¡Œï¼Œå¹¶å°†Systemçœ‹ä½œçº¯å‡½æ•°è€Œä¸æ”¹å˜Component stateã€‚ä½†å®é™…ä¸­ï¼Œä»ç„¶æœ‰Systeméœ€è¦æ”¹å˜stateï¼Œè¿™éœ€è¦Systemè‡ªå·±ç®¡ç†å¤æ‚æ€§ã€‚

### Example: Connection(AFK)

![Connection System](connection_system.png)

ä»£ç ä¸­çš„Systemå°†ä¼šéå†æ‰€æœ‰`Connection Component`ï¼Œæ£€æµ‹ç©å®¶æ˜¯å¦AFKï¼ˆå³ä¿—ç§°çš„æŒ‚æœºï¼‰ã€‚`Connection Component`å¯¹åº”ç©å®¶ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ï¼ŒæŒ‚åœ¨ä»£è¡¨ç©å®¶çš„Entityä¸Šã€‚è¿™é‡Œçš„Entityå¯ä»¥æ˜¯æ¸¸æˆç©å®¶ï¼Œå¯ä»¥æ˜¯æ—è§‚è€…ï¼Œå¯ä»¥æ˜¯æˆ¿ä¸»ï¼Œè¯¥Systemä¸å…³æ³¨è¿™äº›ç»†èŠ‚ï¼Œåªå…³æ³¨AFKè¿™ä»¶äº‹æœ¬èº«ã€‚

æ¯ä¸ª`Connection Component`åŒ…å«äº†`InputStream`å’Œ`Stats Component`ï¼ˆåº”è¯¥æ˜¯ç©å®¶çš„å±€å†…è¯„åˆ†ï¼‰ã€‚å½“ç©å®¶è¾“å…¥äº†æŸäº›æŒ‰é”®ï¼Œæˆ–è€…å¯¹å›¢é˜Ÿåšäº†æŸäº›è´¡çŒ®ï¼ˆä¾‹å¦‚å¢è¥¿å¥¥ç«™ç€ä¸åŠ¨å¥¶åˆ°åˆ«äººéƒ½ç®—æœ‰è´¡çŒ®ï¼‰ï¼Œå³æ¸…ç©ºAFKï¼Œå¦åˆ™ä¸æ–­è®¡æ—¶ç›´åˆ°AFKè§¦å‘ã€‚

~~æ‰€ä»¥è¦æ˜¯æƒ³è§£å†³é•¿æœŸæŒ‚æœºè¢«è¸¢çš„é—®é¢˜æ˜¯ä¸æ˜¯åªè¦æä¸ªå‡ç©å®¶åœ¨æ—è¾¹å¥¶ä»–å°±è¡Œäº†~~

Systemä¸Šè¿è¡Œçš„entityéƒ½éœ€è¦æœ‰å®Œæ•´çš„Component tupleã€‚ä¾‹å¦‚ï¼Œæ¸¸æˆä¸­çš„æœºå™¨äººæœ‰`Stat Component`ï¼Œä½†æ˜¯æ²¡æœ‰`InputStream`å’Œ`Connection Component`ï¼Œå› æ­¤ä»–ä¸ä¼šè¿›è¡Œè¯¥Behaviorã€‚

## Why not OOP?

ä¸Šé¢çš„AFKä¾‹å­ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç”¨OOPçš„æ€æƒ³ç®¡ç†å‘¢ï¼Ÿæ¯”å¦‚é‡è½½Connectionçš„updateå‡½æ•°ï¼Œåœ¨é‡Œé¢è¿›è¡ŒAFKæ£€æµ‹ï¼Ÿ

å›åˆ°ECSä¸­çš„Componentå®šä¹‰ä¸Šæ¥ã€‚`Connection Component`åªä¿å­˜çŠ¶æ€ï¼Œè¿™æ„å‘³ç€å…¶å¯ä»¥è¢«å¤šä¸ªBehaviorå¤ç”¨ï¼šAFKæ£€æµ‹ã€èƒ½æ¥å—ç½‘ç»œå¹¿æ’­çš„ç©å®¶åˆ—è¡¨ã€è§£æç©å®¶çŠ¶æ€ï¼ˆå¦‚ç©å®¶åå­—ã€ç©å®¶æˆå°±ï¼‰ã€‚å¦‚æœç”¨OOPçš„æ–¹å¼æ¥åšï¼Œé‚£ä¹ˆ`Connection Component`çš„updateå‡½æ•°å°†è¿‡äºç¹æ‚ï¼ŒåŒ…å«å¤ªå¤šçš„Behaviorã€‚

åœ¨OOPä¸­ï¼Œç±»æ—¢ä»£è¡¨Stateåˆä»£è¡¨Behaviorã€‚**ä½†Componentåœ¨ä¸åŒçš„Systemã€ä¸åŒçš„æ—¶é—´ç‚¹ä¸‹æ„å‘³ç€å®Œå…¨ä¸åŒçš„äº‹ï¼Œå®ƒåªä¿å­˜çŠ¶æ€State**ã€‚

----

å½“ç„¶ï¼Œä¸Šé¢çš„è§£é‡Šè¿˜æ˜¯è¿‡äºå…ˆå°„ç®­å†ç”»é¶ï¼Œè®©æˆ‘ä»¬æŠŠè§†è§’åˆ‡æ¢ä¸€ä¸‹å§ã€‚

Tim Fordï¼ˆå³æ¼”è®²è€…ï¼Œå®ˆæœ›å…ˆé”‹å›¢é˜Ÿleaderï¼‰ä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼šä¸åŒäººã€ä¸åŒèº«ä»½å»è§‚å¯ŸåŒä¸€æ£µæ¨±èŠ±æ ‘ï¼Œä¼šçœ‹è§ä¸åŒçš„Behaviorã€‚æ ‘åœ¨è¿™é‡Œæ˜¯æ˜¯è¢«ä¸åŒè§‚å¯Ÿè€…åŒºåˆ«å¯¹å¾…çš„Subjectã€‚

å†å›åˆ°ä¸Šé¢çš„`Connection Component`ï¼Œå…¶åœ¨ç®¡ç†ç©å®¶è¿æ¥çš„Systemä¸­è¢«çœ‹ä½œAFKè¸¢å‡ºæ¸¸æˆçš„Subjectã€åœ¨`ConnectUtility`ä¸­è¢«çœ‹ä½œå¹¿æ’­ç©å®¶ç½‘ç»œä¿¡æ¯çš„Subjectã€å®¢æˆ·ç«¯Clientä¸Šè¢«çœ‹ä½œè®¡åˆ†æ¿ä¸Šå¸¦æœ‰ç©å®¶åå­—çš„UI Subjectã€‚

æš´é›ªè®¤ä¸ºï¼š**æ ¹æ®Subjectçš„è§†è§’æ¥åŒºåˆ†æ‰€æœ‰Behaviorï¼Œä»è€Œæè¿°æ¸¸æˆå¯¹è±¡ï¼ˆæ¯”å¦‚ä¾‹å­ä¸­çš„æ ‘ï¼‰çš„å…¨éƒ¨Behavioræ–¹å¼ï¼Œç›¸æ¯”OOPä¼šæ›´ç®€å•ã€‚**

## Problem

æ¥ä¸‹æ¥çš„æè¿°æ›´åƒæ˜¯æŒ‰æ—¶é—´çº¿ï¼Œä»æœ€å¼€å§‹çš„OWåŸå‹å¼€å§‹ã€‚

ECSçš„åŸåˆ™ï¼ˆSystemæ²¡æœ‰Stateï¼ŒComponentæ²¡æœ‰Behaviorï¼‰çœ‹ä¸Šå»å¾ˆæœ´ç´ ï¼Œä½†åœ¨å®é™…ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³è®©Systemæœ‰çŠ¶æ€ï¼Œæ¯”å¦‚æˆå‘˜å˜é‡ã€‚æ¯”å¦‚ï¼Œå¯¹äº`InputSystem`ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°å°†ç”¨æˆ·è¾“å…¥ä¿¡æ¯ä¿å­˜åœ¨Systemä¸­ï¼Œå…¶ä»–Systemå‘`InputSystem`è·å–è¾“å…¥ä¿¡æ¯ã€‚

å¦å¤–ï¼Œç”±äºå¼€å‘ä¸€ä¸ªæ–°çš„Componentå¾ˆå®¹æ˜“å¸Œæœ›å…¶æœ‰å¤šä¸ªå®ä¾‹ï¼ˆè¿™ä¹Ÿåˆ‡åˆä»£ç ä¸­é€šè¿‡æ¨¡æ¿è¿­ä»£è®¿é—®Componentçš„æ–¹å¼ï¼‰ï¼Œåœ¨Componentå†…ä¿å­˜å…¨å±€å˜é‡ä¼šå¯¼è‡´å…¶æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤ªå¯¹åŠ²çš„ã€‚

å‡ºäºä»¥ä¸ŠåŸå› ï¼Œæš´é›ªåœ¨å¼€å‘æœ€åˆç‰ˆæœ¬æ—¶åœ¨Systemä¸­ä¿å­˜äº†ä¸€æ¬¡æ€§ï¼ˆone-offï¼‰çš„çŠ¶æ€ï¼Œå¹¶æä¾›äº†å…¨å±€è®¿é—®å‡½æ•°ï¼Œå…¶ä»–Systemå¯ä»¥è®¿é—®Systemï¼Œä»è€Œè·å–è¿™äº›çŠ¶æ€ã€‚å¦‚ä¸‹å›¾ä¸­ï¼Œ`CommandSystem`è·å–`InputSystem`æŒ‡é’ˆï¼Œå¹¶é€šè¿‡æŒ‡é’ˆè®¿é—®Stateã€‚

![Access State Through System](ecs_access_through_system.png)

ä»å®é™…å·¥ç¨‹çš„è§’åº¦è€Œè¨€ï¼Œè¿™ç§æ–¹å¼ä¼šå¢åŠ ç¼–è¯‘æ—¶é—´ï¼ˆå³å¼•ç”¨äº†å…¶ä»–Systemçš„å¤´æ–‡ä»¶ï¼‰ï¼Œå¹¶è®©Systemä¹‹é—´äº§ç”Ÿäº†è€¦åˆï¼ŒSystemä¹‹é—´äº’ç›¸æš´éœ²äº†å†…éƒ¨è¡Œä¸ºçš„å®ç°ï¼Œå¦‚æœæœ‰æ–°çš„éœ€æ±‚æ¥ï¼Œé€‰æ‹©åœ¨System1è¿˜æ˜¯System2æ·»åŠ ä»£ç ï¼ˆå‡è®¾ä¸¤ä¸ªè€¦åˆï¼‰å˜å¾—éš¾ä»¥æŠ‰æ‹©ã€‚

å½“ç„¶ï¼Œä»£ç è¿˜æ˜¯èƒ½å†™ä¸‹å»çš„ï¼Œç›´åˆ°æ–°çš„é—®é¢˜å‡ºç°ã€‚

### Killcamï¼ˆæ­»äº¡å›æ”¾ï¼‰

ç©è¿‡OWçš„éƒ½å¾ˆæ¸…æ¥šè¿™æ˜¯ä»€ä¹ˆï¼Œå³ç©å®¶ç©çš„è§’è‰²æ­»äº¡ï¼ˆæ¯”å¦‚å®‰å¨œè¢«é“æ‹³æ›¹é£ï¼‰ï¼Œå®¢æˆ·ç«¯ä¼šæä¾›å¯¹æ–¹è§†è§’çš„ä¸€éƒ¨åˆ†å›æ”¾ï¼Œä»è€Œè®©ä½ çŸ¥é“ä½ æ˜¯æ€ä¹ˆè¢«æ›¹é£çš„ã€‚

ï¼ˆè¢«ä¸çŸ¥é“å“ªæ¥çš„é“æ‹³æ›¹é£çœŸæ˜¯ææ€–ç‰‡å§ï¼‰

ä½†è®©æˆ‘ä»¬ä»å·¥ç¨‹è§’åº¦æ¥è€ƒè™‘ã€‚ä¸ºäº†å®ç°å›æ”¾åŠŸèƒ½ï¼Œæ¸¸æˆå†…å¿…ç„¶éœ€è¦æœ‰ä¸¤ä¸ªå¹¶è¡Œçš„ç¯å¢ƒï¼ˆenvironmentï¼‰ï¼Œä¸€ä¸ªä¸ºå®æ—¶æ¸¸æˆï¼Œä¸€ä¸ªä¸“é—¨ç”¨äºKillcamã€‚å®ç°æ–¹å¼ä¹Ÿå¾ˆè‡ªç„¶ï¼š**åŠ ä¸€ä¸ªå…¨æ–°çš„ECS World**ã€‚äºæ˜¯ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªWorldï¼šä¸€ä¸ªliveGameï¼Œä¸€ä¸ªreplayGameã€‚æœåŠ¡å™¨ä¸‹å‘8~12ç§’æ¸¸æˆæ•°æ®ï¼Œå®¢æˆ·åˆ‡æ¢è‡³replayAdmin Worldï¼Œå¹¶å°†æ•°æ®å½“ä½œä»æ­£å¸¸ç½‘ç»œæ¥çš„æ¥è¿›è¡Œæ¸²æŸ“ã€‚è¿™æ ·ï¼Œæ‰€æœ‰çš„Systemã€Componentéƒ½ä¸çŸ¥é“æ•°æ®æ¥è‡ªreplayè¿‡ç¨‹ï¼ˆåŸæ–‡ä¸ºbe predictedï¼Œå³å…¶ä»–æ¼”è®²æ‰€è¿°çš„åŒæ­¥ï¼‰ï¼Œä»¥ä¸ºæ•°æ®æ¥è‡ªäºæ­£å¸¸æ¸¸æˆè¿›ç¨‹ã€‚

å¼•å…¥ç¬¬äºŒä¸ªWorldå¯¼è‡´æ¸¸æˆä»£ç ä¸­ï¼Œæ‰€æœ‰è®¿é—®å…¨å±€Systemçš„ä»£ç éƒ½ä¼šå‡ºé”™ï¼ˆå› ä¸ºä¸¤ä¸ªWorldå…·æœ‰ä¸¤ä¸ªSystemï¼Œï¼‰ï¼Œå¦‚ä¸Šå›¾é»„è‰²ç¬¬äºŒè¡Œä¸èƒ½é€šè¿‡`g_game-m_inputSystem`è®¿é—®ï¼Œåªèƒ½é€šè¿‡å…±äº«çš„`EntityAdmin`è®¿é—®ã€‚

----

Killcamå¼•å…¥åï¼Œå¥‡æ€ªçš„é€šè¿‡Systemè®¿é—®Stateæ–¹å¼ã€ç¼–è¯‘å‘¨æœŸå¤ªé•¿ï¼Œå†…éƒ¨ç³»ç»Ÿçš„è€¦åˆç»ˆäºè®©æš´é›ªå¼€å§‹åæ€å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œç»“è®ºä¾¿æ˜¯ï¼š**å¼€å‘å•ç‹¬ä¸€ä¸ªå®ä¾‹çš„Componentæ˜¯å¯¹çš„**ã€‚ç›¸ä¿¡çŸ¥é“è®¾è®¡æ¨¡å¼çš„è¯»è€…ååº”è¿‡æ¥äº†ï¼š**å•ä¾‹ï¼ˆSingletonï¼‰Component**ã€‚

å›¢é˜Ÿå°†åŸæœ¬Systemä¸­ä¿å­˜çš„Stateå…¨éƒ¨è½¬å˜ä¸ºå•ä¾‹Componentï¼ˆå¤§çº¦40%çš„Componentæ˜¯å•ä¾‹çš„ï¼‰ï¼Œè¿™äº›åŒ¿åçš„Entityï¼Œå¯ä»¥é€šè¿‡`EntityAdmin`ç›´æ¥è®¿é—®ã€‚åœ¨åç»­çš„å¼€å‘ä¸­ï¼Œå›¢é˜Ÿå‘ç°åªè¢«å•ä¸ªSystemè®¿é—®çš„Stateæ˜¯å¾ˆå°‘è§çš„ï¼Œé€šè¿‡å•ä¾‹Componentå­˜å‚¨è¿™äº›çŠ¶æ€ï¼Œå¯ä»¥è§£å†³ä¸åŒSystemä¹‹é—´åŸå…ˆå› ä¸ºè®¿é—®Stateå¯¼è‡´çš„è€¦åˆã€‚å¦‚ä¾‹å­ä¸­çš„Input Stateï¼Œå…¶ä»–Systemæ— éœ€å†å»æ‰¾`InputSystem`ï¼Œè€Œæ˜¯ç›´æ¥ä»æ‰€å±çš„Adminç›´æ¥æ‰¾åˆ°å¯¹åº”çš„Input Componentè®¿é—®ã€‚

![Access State Through Singleton](ecs_access_through_singleton.png)

å½“ç„¶ï¼Œè¿™ç§ä¾èµ–adminçš„utilityå‡½æ•°è®¿é—®å•ä¾‹Componentçš„æ–¹å¼è¿˜æ˜¯æœ‰ä¸€äº›è€¦åˆï¼Œè¿™ä»¶äº‹åé¢å†æã€‚

åœ¨è°ƒæ•´åçš„æ¶æ„ä¸­ï¼Œ`InputSystem`ä»…å®Œæˆè¯»å–æ“ä½œç³»ç»Ÿçš„è¾“å…¥ï¼Œå¡«å……å•ä¾‹Input Componentçš„è¿‡ç¨‹ã€‚å•ä¾‹ä¸­å¯ä»¥ä¿å­˜æŒ‰é”®ç»‘å®šç­‰ä¿¡æ¯ï¼Œè¿™æ ·`InputSystem`ä¾¿å’Œå…¶ä»–Systemå¦‚`CommandSystem`è§£è€¦ã€‚æ–°å¢åŠ çš„éœ€æ±‚ï¼Œå¦‚`PostBuildPlayerCommand`å‡½æ•°ä¾¿å¯ä»¥å¾ˆæ¸…æ™°åœ°æ”¾åœ¨`CommandSystem`ä¸­ï¼Œç”¨äºå¤„ç†æ‰€æœ‰å¯¹ç©å®¶å‘½ä»¤çš„ä¿®æ”¹ã€‚è¿™äº›ç©å®¶å‘½ä»¤å°†ç”¨äºç½‘ç»œåŒæ­¥ï¼Œæ¨¡æ‹Ÿæ¸¸æˆè¿›ç¨‹ã€‚

è¿™ç§ä¿®æ”¹å¢åŠ äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå› ä¸ºæ¯ä¸€æ¬¡Updateå¯¹`Command`çš„ä¿®æ”¹åªä¼šåœ¨`CommandSystem`çš„`BuildPlayerCommand`å‡½æ•°å‡ºç°ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹å¯¹ç©å®¶å‘½ä»¤çš„ç¼–è¾‘æ“ä½œï¼Œåªè¦åœ¨è¿™é‡Œä¿®æ”¹å³å¯ï¼Œè€Œä¸ç”¨åˆ°å…¶ä»–Systemæ–‡ä»¶å¦‚`InputSystem`ä¸­ä¿®æ”¹ã€‚

### Sharing Behavior

æœ‰çš„æ—¶å€™ï¼ŒåŒä¸ªSubjectçš„ä¸¤ä¸ªobserverä¼šå¯¹åŒä¸€ä¸ªBehavioræ„Ÿå…´è¶£ï¼Œåœ¨ä»£ç ä¸­å‘ˆç°ä¸ºåŒä¸€ä¸ªBehaviorè¢«å¤šä¸ªSystemæ‰€ç”¨ã€‚

æ¯”å¦‚ï¼Œè®¸å¤šä»£ç éƒ½ä¼šå…³æ³¨æ•Œå¯¹å…³ç³»ï¼ˆHostilityï¼‰ï¼Œè¿™æ˜¯ç”±ä¸‰ä¸ªå¯é€‰çš„Componentå†³å®šçš„ï¼š`Filter bits`ï¼ˆä¿å­˜Entityçš„é˜Ÿä¼ç¼–å·ï¼‰ï¼Œ`Pet master`ï¼ˆä¿å­˜æ‹¥æœ‰çš„æ‰€æœ‰petçš„`Unique key`ï¼‰å’Œ`Pet`ï¼ˆå¦‚æ‰˜æ¯”æ˜‚çš„ç‚®å°ï¼‰ã€‚åœ¨æ¸¸æˆä¸­ï¼Œè‹¥ä¸¤ä¸ªEntityéƒ½æ²¡æœ‰`Filter bits`ï¼Œé‚£è‡ªç„¶ä¸æ˜¯æ•Œå¯¹çš„ï¼ˆæ¯”å¦‚è½¦å’Œå¼€å…³é—¨ï¼‰ï¼›è‹¥ä¸¤ä¸ªEntityéƒ½åœ¨åŒä¸€ä¸ªé˜Ÿä¼ï¼Œé‚£ä¹Ÿè‚¯å®šä¸æ˜¯æ•Œå¯¹çš„ã€‚è‹¥ä¸¤ä¸ªEntityæ˜¯æ•Œå¯¹çš„ï¼Œé‚£ä¹ˆå°†ä¼šåŒæ—¶æ£€æŸ¥è‡ªå·±å’Œå¯¹æ–¹çš„`Pet master` Componentï¼Œç¡®ä¿æ¯ä¸ª`Pet`å’Œå¯¹æ–¹éƒ½æ˜¯æ•Œå¯¹çš„ã€‚

æ•Œå¯¹å…³ç³»çš„å…·ä½“å®ç°ä¸º`CombatUtilityHostile`å‡½æ•°ï¼Œå…¶æ¥å—ä¸¤ä¸ªEntityï¼Œè¿”å›True/Falseè¡¨ç¤ºå®ƒä»¬æ˜¯å¦æ•Œå¯¹ã€‚å¯ä»¥æƒ³åˆ°å¾ˆå¤šSysteméƒ½ä¼šç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°ä»…ç”¨äº†ä¸‰ä¸ªComponentï¼Œè¿˜éƒ½æ˜¯åªè¯»çš„æ–¹å¼è®¿é—®ï¼Œå› æ­¤æ²¡æœ‰äº§ç”Ÿå‰¯ä½œç”¨ã€‚

å¯¹äºè¿™ç±»å…±äº«çš„Utilityå‡½æ•°ï¼Œè‹¥è¿™äº›å‡½æ•°å¾ˆå¸¸ç”¨ï¼Œå°±åº”è¯¥è®©å‡½æ•°ä¾èµ–è¾ƒå°‘çš„Componentï¼Œä¸”ä¸åº”è¯¥äº§ç”Ÿæˆ–è€…å¾ˆå°‘äº§ç”Ÿå‰¯ä½œç”¨ã€‚å€˜è‹¥Utilityå‡½æ•°çœŸçš„éœ€è¦ä¾èµ–å¾ˆå¤šComponentï¼Œé‚£å°±åº”è¯¥é™åˆ¶è¿™äº›å‡½æ•°çš„è°ƒç”¨ç‚¹çš„æ•°é‡ã€‚

----

ä¸Šè¿°ç”¨å…±äº«çš„Utilityå‡½æ•°æ›¿æ¢Systemé—´çš„ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼ï¼Œçœ‹ä¸Šå»æ¶ˆé™¤äº†Systemä¹‹é—´çš„è€¦åˆï¼Œä½†å®é™…ä¸Šåªæ˜¯æŠŠè€¦åˆç§»åŠ¨åˆ°äº†å…±äº«çš„Utilityå‡½æ•°ä¸­ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¥½å‡ å¤„éƒ½éœ€è¦è°ƒç”¨Utilityå‡½æ•°ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé€ æˆç›¸å½“ä¸¥é‡çš„å‰¯ä½œç”¨ï¼ˆside-effortï¼‰ã€‚

æš´é›ªå¸Œæœ›ï¼š**å¦‚æœåªæœ‰ä¸€ä¸ªè°ƒç”¨ç‚¹ï¼Œé‚£ä¹ˆBehaviorçš„å¤æ‚æ€§å°±ä¼šé™ä½**ï¼Œè¿™æ ·ä»»ä½•å‰¯ä½œç”¨éƒ½ä¼šè¢«é™åˆ¶åœ¨è°ƒç”¨ç‚¹å¤„ã€‚

é‚£ä¹ˆå¦‚ä½•å‡å°‘è¿™ç±»è€¦åˆå‘¢ï¼Ÿ

### Defermentï¼ˆæ¨è¿Ÿï¼‰

å¥½çš„Singleton Componentå¯ä»¥é€šè¿‡æ¨è¿Ÿï¼ˆDefermentï¼‰æ¥è§£å†³Systemé—´çš„è€¦åˆï¼šæ¨è¿Ÿäº†å­˜å‚¨Behavioræ‰€éœ€çš„Stateã€‚å°†å…¶å»¶åè‡³tickä¸­æ›´å¥½çš„åœ°æ–¹æ‰§è¡Œã€‚

æ¯”å¦‚ï¼Œä»£ç ä¸­è®¸å¤šè°ƒç”¨ç‚¹éƒ½éœ€è¦ç”Ÿæˆç¢°æ’ç‰¹æ•ˆï¼ˆImpact effectsï¼‰ã€‚è¿™åŒ…æ‹¬å³æ—¶å¼¹é“å­å¼¹ï¼ˆæ¯”å¦‚76å’ŒçŒç©ºçš„å­å¼¹ï¼‰ã€å¸¦é£è¡Œæ—¶é—´çš„å­å¼¹ï¼ˆå¦‚æ³•é¸¡çš„ç‚®å¼¹ï¼‰ã€æ¿€å…‰ï¼ˆå¦‚æ¯›å¦¹ç²’å­å…‰æŸï¼‰å’Œå–·æ¼†ã€‚åˆ›å»ºç¢°æ’ç‰¹æ•ˆçš„å‰¯ä½œç”¨æ˜¯å¾ˆå¤§çš„ï¼Œå› ä¸ºè¿™éœ€è¦åœ¨å±å¹•ä¸Šç”Ÿæˆä¸€ä¸ªæ–°çš„Entityï¼Œè¿™å¯èƒ½ä¼šå½±å“å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸï¼ˆlifetimeï¼‰ã€çº¿ç¨‹ã€åœºæ™¯ç®¡ç†ï¼ˆscene managementï¼‰ç­‰ã€‚ç¢°æ’ç‰¹æ•ˆçš„ç”Ÿå‘½å‘¨æœŸéœ€è¦åœ¨åœºæ™¯æ¸²æŸ“å‰å¼€å§‹ï¼Œå› æ­¤å®ƒä»¬ä¸éœ€è¦å†æ¸¸æˆæ¨¡æ‹Ÿçš„ä¸­é€”ä¸­å‘ˆç°ã€‚

å¯ä»¥æƒ³åˆ°çš„æ˜¯ï¼Œç¢°æ’ç‰¹æ•ˆæ‰€éœ€çš„ä»£ç é‡æ˜¯éå¸¸å¤§çš„ï¼Œå®ƒéœ€è¦åŸºäºå›¾å½¢å­¦çš„Transformï¼ˆä½ç§»ã€æ—‹è½¬å’Œç¼©æ”¾ï¼‰ï¼Œç¢°æ’ç±»å‹ã€æè´¨ç»“æ„æ•°æ®åšç¢°æ’è®¡ç®—ï¼Œè¿˜éœ€è¦è°ƒç”¨LODï¼ˆå³Levels of Detailï¼Œç®€åŒ–å¯è§æ¨¡å‹çš„å‡ ä½•ç»†èŠ‚æ¥é™ä½æ¸¸æˆçš„è´Ÿè½½ï¼‰ã€åœºæ™¯ç®¡ç†ç­‰ç­‰ã€‚è¿™äº›ä»£ç è®©å¼¹å­”ã€ç„¦ç—•ç­‰ç‰¹æ•ˆä¸ä¼šå¥‡æ€ªçš„å åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚çŒç©ºçš„å­å¼¹ä¼šåœ¨å¢™ä¸Šç•™ä¸‹ä¸€ç³»åˆ—è“ç‚¹ï¼Œæ³•é¸¡å¼€ç‚®åçš„ç‰¹æ•ˆå°†ä¼šè¦†ç›–æ‰è¿™äº›è“ç‚¹ï¼Œè€Œä¸æ˜¯å‡ºç°Z-Fightingï¼ˆzè½´å†²çªï¼‰å¯¼è‡´çš„å¥‡æ€ªé—ªçƒã€‚

ä»ä»£ç çš„è§’åº¦è€Œè¨€ï¼ŒæŠŠç¢°æ’ç‰¹æ•ˆç›¸å…³çš„ä»£ç åœ¨ä¸€å¤„æå®šæ˜¯å¾ˆæ­£å¸¸çš„ã€‚ä½†ç”±äºä»£ç è¿‡äºå¤æ‚ï¼Œä¸”ç¢°æ’ç‰¹æ•ˆçš„è°ƒç”¨ç‚¹æå¤šï¼Œä¿®æ”¹ç¢°æ’ç‰¹æ•ˆæ„å‘³ç€æ¯ä¸ªè°ƒç”¨ç‚¹éƒ½è¦é‡æ–°æµ‹è¯•ã€‚å¦å¤–ï¼Œå®ˆæœ›å…ˆé”‹æ˜¯ä¼šä¸æ–­æ¨å‡ºæ–°è‹±é›„çš„ï¼Œæ–°è‹±é›„çš„å‡ºç°ä¼šç»§ç»­å¢åŠ è°ƒç”¨ç‚¹ã€‚ç¨‹åºå‘˜åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œå°±éœ€è¦å¢åŠ å¿ƒæ™ºè´Ÿæ‹…å»è®°ä½ç¢°æ’ä»£ç çš„å‰¯ä½œç”¨ï¼Œä»è€Œå¢åŠ äº†ä»£ç å¤æ‚åº¦ã€‚

äºæ˜¯ä¾¿æœ‰äº†`Singleton Contact Component`ã€‚å…¶åŒ…å«äº†å°šæœªæ¸²æŸ“çš„ç¢°æ’è®°å½•æ•°ç»„ã€‚ç°åœ¨è‹¥æƒ³åˆ›å»ºæ–°çš„ç¢°æ’ç‰¹æ•ˆï¼Œä»…éœ€è¦åœ¨Componentä¸­æ·»åŠ è®°å½•ï¼Œåœ¨tickä¸­çš„è¾ƒåé˜¶æ®µï¼ˆscene updateï¼‰ï¼Œå°†ç»Ÿä¸€ç”Ÿæˆç‰¹æ•ˆã€‚è¿™æ ·ï¼Œå³ä½¿ç¢°æ’ç‰¹æ•ˆå…·æœ‰å‰¯ä½œç”¨ï¼Œä¹Ÿä»…æœ‰ä¸€å¤„è°ƒç”¨ç‚¹ã€‚

![Singleton Contact](singleton_contact.png)

é™¤äº†é™ä½å‰¯ä½œç”¨å¤–ï¼Œâ€œæ¨è¿Ÿâ€è¿˜æœ‰å…¶ä»–çš„ä¼˜ç‚¹ã€‚æ¯”å¦‚ç°åœ¨æœ‰äº†æœ¬åœ°çš„æ•°æ®å’ŒæŒ‡ä»¤çš„è®°å½•ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ€§èƒ½çš„perfã€‚æ¯”å¦‚ç°åœ¨æœ‰12ä¸ªDvaåœ¨å°„å¢™ï¼ŒDvaçš„æ•£å¼¹æªä¼šé€ æˆæ€»å…±æ•°ç™¾ä¸ªç¢°æ’ç‰¹æ•ˆã€‚æ¸¸æˆå¯ä»¥å…ˆæ¸²æŸ“ä½ çš„Dvaçš„ç‰¹æ•ˆï¼Œå†åœ¨ç¨åé˜¶æ®µåˆ†æ‘Šæ¥æ¸²æŸ“å…¶ä»–Dvaçš„ç‰¹æ•ˆï¼Œä»è€Œå¹³æ»‘æ€§èƒ½æ¯›åˆºï¼Œå¦å¤–è¿˜å¯ä»¥å®ç°å…¶ä»–çš„å¤æ‚äº‹æƒ…ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ã€‚

----

Singletonã€Utilityå‡½æ•°ï¼Œä»¥åŠæ¨è¿Ÿï¼Œè¿™äº›ä»…æ˜¯æš´é›ªåœ¨ä¸‰å¹´çš„ECSå®è·µä¸­ç¡®ç«‹çš„ä¸€éƒ¨åˆ†ç¼–ç¨‹èŒƒå¼ã€‚éµå¾ªè¿™äº›å‡†åˆ™éœ€è¦è®©å¼€å‘è€…éœ€è¦ç”¨ä¸å¤ªæ™®é€šçš„æ–¹å¼ï¼ˆå¥‡æ·«æŠ€å·§ï¼‰å»è§£å†³æ™®é€šæ¸¸æˆä¸­çœ‹ä¸Šå»æ¯”è¾ƒç®€å•çš„é—®é¢˜ï¼Œä½†è¿™è®©å®ˆæœ›å…ˆé”‹çš„ä»£ç å˜å¾—å¯æŒç»­å¼€å‘ã€è§£è€¦åˆå’Œç®€æ´ï¼Œ

## Netcodeï¼ˆç½‘ç»œåŒæ­¥ï¼‰

å®ˆæœ›å…ˆé”‹æ˜¯ä¸€æ¬¾å³æ—¶PVPçš„FPSæ¸¸æˆã€‚å› æ­¤ï¼Œåœ¨æ¸¸æˆä¸­å¿…é¡»å¯¹ç©å®¶çš„æ“ä½œåšé¢„æµ‹ï¼ˆpredictï¼‰ï¼Œå› ä¸ºå¦‚æœç©å®¶çš„æ¯ä¸ªæ“ä½œéƒ½éœ€è¦ç­‰å¾…æœåŠ¡å™¨å›å¤çš„è¯ï¼Œå°±ä¸å¯èƒ½åšåˆ°å¿«é€Ÿå“åº”ï¼ˆresponsiveï¼‰ã€‚

é‚£ä¹ˆæœ‰å“ªäº›æ“ä½œéœ€è¦å¿«é€Ÿå“åº”ï¼Ÿç©å®¶çš„ç§»åŠ¨ï¼Œç©å®¶çš„æŠ€èƒ½ï¼ˆæ­¦å™¨ä¹Ÿç®—æŠ€èƒ½ï¼‰ï¼Œä»¥åŠå‘½ä¸­åˆ¤å®šï¼ˆhit registrationï¼‰ã€‚ç©å®¶æŒ‰ä¸‹æŒ‰é’®å°±åº”è¯¥ç«‹åˆ»èƒ½çœ‹åˆ°å“åº”ï¼Œå³ä½¿ç½‘ç»œå»¶è¿Ÿå¾ˆé«˜ä¹Ÿåº”è¯¥å¦‚æ­¤ã€‚ç©å®¶è‚¯å®šä¸èƒ½ä¿è¯æ¸¸æˆçš„ä½å»¶è¿Ÿå’Œä½ä¸¢åŒ…ï¼Œé‚£ä¹ˆå®ˆæœ›å…ˆé”‹è¿™ç§å¸¦é¢„æµ‹çš„å®¢æˆ·ç«¯å°±å¿…ç„¶ä¼šå¸¦æœ‰ä¸¥é‡çš„å‰¯ä½œç”¨ï¼šé¢„æµ‹é”™è¯¯ï¼ˆmispredictionï¼‰ï¼Œå³ç©å®¶æ²¡èƒ½æˆåŠŸæ‰§è¡Œâ€œä½ è®¤ä¸ºå·²ç»åšå‡ºçš„â€æ“ä½œã€‚

å½“ç„¶ï¼ŒæœåŠ¡å™¨æœ€åä¼šå¸®ä½ çº æ­£ä½ çš„é¢„æµ‹é”™è¯¯ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¿™ç§äº‹æƒ…å‘ç”Ÿçš„è¶Šå°‘è¶Šå¥½ã€‚æš´é›ªé€šè¿‡ç¡®å®šæ€§ï¼ˆDeterminismï¼‰è¯•å›¾å‡å°‘é¢„æµ‹é”™è¯¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™éƒ¨åˆ†é‡‡ç”¨çš„æŠ€æœ¯å’Œç®—æ³•å®é™…ä¸Šå¾ˆæˆç†Ÿäº†ï¼Œå®ˆæœ›å…ˆé”‹ä¹‹å‰å·²æœ‰è®¸å¤šä¼˜ç§€çš„FPSæ¸¸æˆã€‚å› æ­¤ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ECSæ¶æ„å¦‚ä½•é™ä½è¿™éƒ¨åˆ†çš„å¤æ‚æ€§ã€‚

### Determinismï¼ˆç¡®å®šæ€§ï¼‰

ç¡®å®šæ€§æ¨¡æ‹ŸæŠ€æœ¯ä¾èµ–äºåŒæ­¥æ—¶é’Ÿï¼ˆSynchronized Clockï¼‰ã€å›ºå®šçš„æ›´æ–°å‘¨æœŸå’Œé‡åŒ–ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½éœ€è¦è¿è¡Œæ—¶é’Ÿå’Œé‡åŒ–å€¼ã€‚æ—¶é—´è¢«é‡åŒ–ä¸ºCommand Frameï¼Œæ¯ä¸ªå‘½ä»¤å¸§ä¸ºå›ºå®šçš„16msï¼ˆå³ä¸€ç§’62.5å¸§ï¼‰ï¼Œæ¯”èµ›æ—¶ä¸º7msï¼ˆâ‰ˆä¸€ç§’142.86å¸§ï¼‰ã€‚å› æ­¤ï¼Œæ¸¸æˆæ¨¡æ‹Ÿè¿‡ç¨‹çš„é¢‘ç‡æ˜¯å›ºå®šçš„ï¼Œæ¸¸æˆé‡‡ç”¨ä¸€ä¸ªå¾ªç¯ç´¯åŠ å™¨æ¥å¤„ç†å¸§å·çš„å¢é•¿ã€‚

åœ¨ECSæ¡†æ¶ä¸­ï¼Œä»»ä½•éœ€è¦è¿›è¡Œpredictï¼Œæˆ–è€…åŸºäºç©å®¶çš„è¾“å…¥æ¥æ¨¡æ‹Ÿçš„Systemï¼Œéƒ½ä¸ä¼šä½¿ç”¨Updateï¼Œè€Œæ˜¯UpdateFixedï¼Œå…¶åœ¨æ¯ä¸ªå›ºå®šçš„å‘½ä»¤å¸§ï¼ˆSingle fixed command frameï¼‰è¢«è°ƒç”¨ã€‚

![alt text](timeline.png)

ç°åœ¨è®©æˆ‘ä»¬å‡å®šç©å®¶ç¯å¢ƒä¸ä¸¢åŒ…ä½å»¶æ—¶ï¼Œé‚£ä¹ˆClientçš„Clockæ€»ä¼šè¶…å‰äºServerï¼Œåœ¨è¿™é‡Œå¤§çº¦ä¸ºä¸€åŠçš„RTTï¼ˆå³ping+é€»è¾‘å¤„ç†æ—¶é—´ï¼‰åŠ ä¸Šä¸€ä¸ªç¼“å­˜frameçš„æ—¶é•¿ã€‚å›¾ä¸­çš„RTTæ—¶é•¿ä¸º160msï¼Œä¸€ä¸ªcommand frameå ç”¨16msï¼Œå³Client Clockè¶…å‰96msã€‚å®¢æˆ·ç«¯ä¸æ–­æ¥å—ç©å®¶è¾“å…¥ï¼Œå› æ­¤æœ€è´´è¿‘ç°åœ¨çš„æ—¶åˆ»ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ç­‰å¾…æœåŠ¡å™¨å›åŒ…æ‰èƒ½å“åº”ï¼Œé‚£ä¹ˆå°±å¤ªæ…¢äº†ã€‚å› æ­¤æˆ‘ä»¬å¸Œæœ›ç¼“å†²çš„frameå°½å¯èƒ½å°‘ã€‚

![alt text](timeline-buffer.png)

åœ¨è¿™é‡Œï¼Œå®¢æˆ·ç«¯çš„é¢„æµ‹Systemå°†è¯»å–å½“å‰è¾“å…¥ï¼Œç„¶åæ¨¡æ‹ŸçŒç©ºçš„ç§»åŠ¨è¿‡ç¨‹ã€‚ç»è¿‡å®Œæ•´çš„RTT+ç¼“å†²ï¼ŒæœåŠ¡å™¨ä¼šå°†æƒå¨çš„ç»“æœå›å¤ç»™å®¢æˆ·ç«¯ã€‚å› æ­¤ï¼Œè¿™é‡Œçš„å‰¯ä½œç”¨å°±æ˜¯éœ€è¦ç»è¿‡RTTæ—¶é—´æ‰èƒ½åˆ°è¾¾å®¢æˆ·ç«¯ã€‚

> åŸè§†é¢‘è¿™é‡Œæ˜¯gifï¼Œæ›´å¥½ç†è§£ä¸€äº›ã€‚

å› æ­¤ï¼Œå®¢æˆ·ç«¯éœ€è¦å°†ç§»åŠ¨ï¼ˆMovementï¼‰å­˜å‚¨åœ¨ç¼“å†²åŒºï¼ˆring bufferï¼‰ä¸­ï¼Œè¿™æ ·æ‰èƒ½å°†movementå’ŒæœåŠ¡å™¨ç»“æœæ¯”è¾ƒã€‚å¦‚æœä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå‘ç”Ÿäº†é¢„æµ‹é”™è¯¯ï¼Œéœ€è¦è¿›è¡Œä¿®å¤ï¼ˆreconcileï¼‰ã€‚å¦‚æœæˆ‘ä»¬ç®€å•çš„å°†å®¢æˆ·ç«¯ç©å®¶çš„ä½ç½®ä¿®æ”¹ä¸ºæœåŠ¡å™¨ç»“æœï¼Œè¿™è‡ªç„¶æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºè¯¥ä½ç½®æ¥è‡ªäºå‡ ç™¾æ¯«ç§’ä¹‹å‰ã€‚å®¢æˆ·ç«¯éœ€è¦ç¼“å­˜Inputä¿¡æ¯ï¼Œè¿™æ ·ä¸€æ—¦ä»æœåŠ¡å™¨å›åŒ…å‘ç°é¢„æµ‹å¤±è´¥ï¼Œå¯ä»¥å°†ç©å®¶çš„å…¨éƒ¨è¾“å…¥éƒ½é‡å¤ä¸€éï¼Œç›´è‡³è¿½ä¸Šå½“å‰æ—¶åˆ»ã€‚

![alt text](timeline_stunned.png)

å½“ä½ è¢«OW1éº¦å…‹é›·çš„é—ªå…‰å¼¹æ™•åˆ°çš„æ—¶å€™ï¼Œè¿™ä¸€æ—¶åˆ»æœåŠ¡å™¨è®¤ä¸ºä½ è¢«æ™•äº†ï¼Œä½†å®¢æˆ·ç«¯çš„ä¿¡æ¯è¿˜åœ¨ä¼ è¾“ï¼Œå› æ­¤ç©å®¶è§†è§’ä¸­çŒç©ºè¿˜åœ¨ç§»åŠ¨ã€‚ä¿®å¤æ–¹å¼å…¶å®å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·å›åˆ°æœ€è¿‘çš„æœåŠ¡å™¨è®¤è¯çš„æ—¶åˆ»ï¼Œç„¶åé‡å¤æ‰€æœ‰çš„Inputï¼Œç›´åˆ°å½“å‰æ—¶åˆ»ã€‚

![alt text](timeline_rerunning.png)

æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½çŸ¥é“éº¦å…‹é›·çš„æ™•å¤§çº¦å¤šå°‘ç§’ï¼Œå› æ­¤å¯ä»¥åŒæ­¥çš„è¿›è¡Œã€‚

----

å®ˆæœ›å…ˆé”‹æ˜¯åœ¨UDPï¼ˆwith optional custom reliability layerï¼‰ä¸Šè¿›è¡Œçš„ï¼Œå› æ­¤å®¢æˆ·ç«¯å¹¶ä¸èƒ½ä¿è¯ä¸ä¸¢åŒ…ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨è¯•å›¾ä¿æŒä¸€ä¸ªä¿å­˜æœªæ¨¡æ‹Ÿè¾“å…¥çš„ç¼“å†²åŒºï¼Œå¹¶å¸Œæœ›å…¶å°½å¯èƒ½çš„å°ï¼ˆä»è€Œè®©æ¸¸æˆå°½å¯èƒ½å¿«é€Ÿå“åº”ï¼‰ã€‚ä¸€æ—¦è¯¥ç¼“å†²åŒºä¸ºç©ºï¼ŒæœåŠ¡å™¨åªèƒ½èƒ½æ ¹æ®ä½ çš„æœ€åä¸€æ¬¡è¾“å…¥æ¥çŒœæµ‹ã€‚å½“çœŸæ­£çš„ç”¨æˆ·è¾“å…¥åˆ°è¾¾æ—¶ï¼Œå…¶ä¼šè¯•å›¾ç¡®ä¿ä¸ä¼šå¼„ä¸¢ç©å®¶çš„ä»»ä½•æ“ä½œï¼Œä½†ä»ç„¶å­˜åœ¨é¢„æµ‹é”™è¯¯ã€‚

![alt text](timeline_lost.png)

ä¸Šå›¾ä¸­ï¼ŒæœåŠ¡å™¨æ„è¯†åˆ°å®¢æˆ·ç«¯çš„åŒ…å‘ç”Ÿä¸¢å¤±ï¼Œé‚£ä¹ˆå°±ä¼šç”¨ç©å®¶æœ€åä¸€æ¬¡æ“ä½œè¿›è¡Œé¢„æµ‹ï¼ˆè¿™å½“ç„¶æ˜¯ä¸€ä¸ªå¯å‘å¼çš„åšæ³•ï¼Œä½†æœåŠ¡å™¨è¿˜èƒ½åšå•¥å‘¢ï¼Ÿï¼‰ï¼Œç„¶åå‘åŒ…ç»™å®¢æˆ·ç«¯å‘ŠçŸ¥ä¸¢åŒ…ã€‚

æ¥ä¸‹æ¥å‘ç”Ÿçš„äº‹çœ‹ä¸Šå»å°±æ¯”è¾ƒå¥‡æ€ªï¼šå®¢æˆ·ç«¯ä¼šè¿›è¡Œæ—¶é—´è†¨èƒ€ï¼ˆdilate timeï¼‰ï¼Œå°†ä¼šæ¯”çº¦å®šçš„å¸§ç‡æ›´å¿«çš„è¿›è¡Œæ¨¡æ‹Ÿã€‚æ¯”å¦‚åŸå…ˆçº¦å®šä¸€å¸§16msï¼Œç°åœ¨å®¢æˆ·ç«¯ä¼šå‡è£…ä¸ºä¸€å¸§15.2msã€‚è¿™æ ·ä¼šå¯¼è‡´è¾“å…¥æµè¶Šæ¥è¶Šå¿«ï¼ŒæœåŠ¡å™¨ç«¯ç¼“å†²åŒºä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œä»è€Œå°½å¯èƒ½å…‹æœä¸¢åŒ…é—®é¢˜ã€‚è¿™ç§æŠ€æœ¯åœ¨ç»å¸¸æŠ–åŠ¨çš„Internetç¯å¢ƒä¸­è¿è¡Œè‰¯å¥½ã€‚

![alt text](timeline_dilate.png)

ä¸Šå›¾ä¸­ï¼Œå®¢æˆ·ç«¯çš„å‘åŒ…å˜å¾—é¢‘ç¹ï¼ˆå³dilate timeï¼‰ï¼Œç¼“å†²åŒºä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚è¿™æœ¬è´¨æ˜¯é€šè¿‡å¢åŠ å‘åŒ…æ¥å°½å¯èƒ½å‡å°ä¸¢åŒ…çš„å½±å“ã€‚å¦‚æœæœåŠ¡å™¨å‘ç°å®¢æˆ·ç«¯çš„ç½‘ç»œé‡æ–°å˜å¾—æ­£å¸¸ï¼Œé‚£ä¹ˆå°±ä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¼šæ›´æ…¢çš„å‘åŒ…ï¼ŒåŒæ—¶æœåŠ¡å™¨ä¹Ÿä¼šå‡å°ç¼“å†²åŒºå¤§å°ã€‚

å¦‚æœä¸¢åŒ…æŒç»­å‘ç”Ÿï¼Œé‚£æˆ‘ä»¬ä¼šå¸Œæœ›ä¸è¦è¶…è¿‡è¯¥æ–¹æ³•çš„æ‰¿å—æé™ï¼Œå¹¶é€šè¿‡è¾“å…¥å†—ä½™æ¥ä½¿é¢„æµ‹é”™è¯¯æœ€å°åŒ–ã€‚è§£å†³æ–¹æ³•ä¾¿æ˜¯æ»‘åŠ¨çª—å£ï¼Œå®¢æˆ·ç«¯å°†ç»´æŒä¸€ä¸ªè¾“å…¥çš„æ»‘åŠ¨çª—å£ï¼Œå­˜å‚¨ä»æœ€åä¸€æ¬¡è¢«æœåŠ¡å™¨ç¡®è®¤çš„æ—¶åˆ»åˆ°ç°åœ¨çš„å…¨éƒ¨çŠ¶æ€ï¼Œå‘åŒ…æ—¶å°†æŠŠè¯¥çª—å£æ‰“åŒ…å‘é€ã€‚ç”±äºç©å®¶çš„æ“ä½œä¸å¤§å¯èƒ½åƒå¸§ç‡ä¸€æ ·ä¸€ç§’60æ¬¡ï¼Œå› æ­¤å‹ç¼©åæ•°æ®é‡å¹¶ä¸å¤§ã€‚è¿™æ ·ï¼Œå³ä½¿å¶å‘çš„å‘ç”Ÿä¸¢åŒ…ï¼Œä¸‹ä¸€æ¬¡æ•°æ®åŒ…åˆ°è¾¾æ—¶ä¾ç„¶æœ‰å…¨éƒ¨çš„è¾“å…¥æ“ä½œï¼Œä»è€Œå¡«è¡¥æœåŠ¡å™¨ä¸Šçš„ç¼“å†²åŒºç©ºæ´ï¼ˆå¯ä»¥è‡ªç„¶çš„æƒ³åˆ°ï¼Œå¤šä½™çš„æ“ä½œå’Œä¹‹å‰çš„å¢åŠ å‘åŒ…æœºåˆ¶æ˜¯å¾ˆå¥‘åˆçš„ï¼‰ã€‚

----

è‹±é›„çš„æ‰€æœ‰èƒ½åŠ›éƒ½æ˜¯é€šè¿‡æš´é›ªè‡ªæœ‰çš„æŒ‡ä»¤å¼è„šæœ¬è¯­è¨€StateScriptå¼€å‘çš„ï¼Œå…¶ä¹Ÿèƒ½å¥‘åˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„éªŒè¯è¿‡ç¨‹ï¼Œå³æ ¹æ®æœåŠ¡å™¨å¿«ç…§å›æ»šï¼Œç„¶åå†å‰æ»šã€‚è¿™å’Œä¹‹å‰çš„çŒç©ºç§»åŠ¨ä¾‹å­æ˜¯å¾ˆåƒçš„ï¼Œè¿™é‡Œæäº†ä¸€å˜´åªæ˜¯ä¸ºäº†è¯´æ˜è‹±é›„çš„èƒ½åŠ›ã€æ­¦å™¨ç­‰ç­‰å®è´¨å’Œç§»åŠ¨æ˜¯ä¸€æ ·çš„ï¼Œå®¢æˆ·ç«¯éƒ½éœ€è¦æ ¹æ®æœåŠ¡å™¨çš„å›å¤åˆ¤æ–­æ˜¯å¦éœ€è¦å€’é€€å†é‡æ”¾ï¼Œæˆ–è€…ç»§ç»­æ¸¸æˆè¿‡ç¨‹ã€‚

### Hit Registration

ECSå¤„ç†è¿™éƒ¨åˆ†æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚å›é¡¾ä¹‹å‰æ‰€æåˆ°çš„æ•Œå¯¹å…³ç³»ï¼ˆHostilityï¼‰ï¼ŒSubjectå¦‚æœæ‹¥æœ‰Behavioræ‰€éœ€çš„Component tupleï¼Œé‚£ä¹ˆBehaviorå°±ä¼šåœ¨å…¶ä¸Šæ‰§è¡Œã€‚è‹¥ç©å®¶çš„è§’è‰²ï¼ˆSubjectï¼‰æ˜¯æ•Œå¯¹çš„ï¼Œä¸”æœ‰ä¸€ä¸ª`ModifyHealthQueue Component`ï¼Œé‚£ä¹ˆç©å®¶ä¾¿å¯ä»¥è¢«å…¶ä»–ç©å®¶å‡»ä¸­ï¼Œæ‰§è¡ŒHit Registrationã€‚

> `ModifyHealthQueue Component`è®°å½•äº†ç©å®¶çš„å…¨éƒ¨ä¼¤å®³å’Œæ²»ç–—ã€‚å¯ä»¥æƒ³åˆ°çš„æ˜¯å®ƒå’Œä¹‹å‰çš„`Singleton Contact`ä¸€æ ·ï¼Œå…·æœ‰å¤šä¸ªè°ƒç”¨ç‚¹ä¸”å…·æœ‰å‰¯ä½œç”¨ï¼Œå› æ­¤å’ŒContactä¸€æ ·æ¨è¿Ÿï¼ˆDefermentï¼‰è®¡ç®—ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¼¤å®³ä¸ä¼šåœ¨å®¢æˆ·ç«¯è¿›è¡Œé¢„æµ‹ï¼ˆå› ä¸ºå¤–æŒ‚ï¼‰ï¼Œä½†å‘½ä¸­åˆ¤å®šæ˜¯éœ€è¦åœ¨å®¢æˆ·ç«¯å¤„ç†çš„ã€‚æ‰€ä»¥å½“Subjectæœ‰ä¸€ä¸ª`MovementState Component`ï¼Œä¸”ä¸æ˜¯è¢«æœ¬åœ°ç©å®¶æ‰€æ“çºµçš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šæ ¹æ®æœ€åæ”¶åˆ°çš„ä¸¤æ¬¡`MovementState`é€šè¿‡`Movementstate System`çš„æ’å€¼ï¼ˆInterpolateï¼‰è¿ç®—æ¥é‡æ–°å®šä½ã€‚`MovementState Component`ä¸­è¿˜éœ€è¦ç»´æŠ¤ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼ˆå°±åƒä¹‹å‰çš„çŒç©ºä¾‹å­ä¸€æ ·ï¼‰ã€‚

æœåŠ¡å™¨åœ¨è®¡ç®—å‘½ä¸­ä¹‹å‰ï¼Œä¼šå°†ç©å®¶å›æ»šåˆ°æ”»å‡»è€…ä¸ŠæŠ¥æ”»å‡»æ—¶ä½ æ‰€åœ¨çš„å¸§ï¼ˆé€šè¿‡ç¼“å†²çš„`MovementState Component`å®ç°ï¼‰ï¼Œè¯¥è¿‡ç¨‹è¢«ç§°ä¸º`å‘åç¼“å’Œï¼ˆbackwards reconcilationï¼‰`ã€‚è¿™å’Œ`ModifyHealthQueue`æ—¶æ­£äº¤çš„ï¼Œæ‰€ä»¥å‘½ä¸­ä¸ä»£è¡¨ä¸€å®šå—åˆ°ä¼¤å®³ï¼Œæ¯”å¦‚é›†ä¸­é—¨ã€å¹³å°å’Œè½¦ï¼Œè¿™ä»ç„¶éœ€è¦å€’å›ï¼ˆrewindï¼‰çŠ¶æ€ï¼Œä½†ä¸ä¼šäº§ç”Ÿä¼¤å®³ã€‚å¦‚æœç©å®¶æ˜¯æ•Œå¯¹çš„ï¼Œä¸”æœ‰`MovementState Component`ï¼Œæ‰ä¼šå› ä¸ºå‘åç¼“å’Œæ”¶åˆ°å‘½ä¸­åˆ¤å®šï¼Œä»è€Œå—ä¼¤ã€‚

è¢«å€’å›ï¼ˆRewindï¼‰æ˜¯ä¸€ç»„è¢«Utilityå‡½æ•°æ“çºµçš„Behaviorï¼Œè€Œå—ä¼¤æ˜¯`MovementState`è¢«å»¶è¿Ÿå¤„ç†çš„å¦ä¸€ä¸ªBehaviorï¼Œè¿™ä¸¤ç§Behavioræ˜¯ä¸åŒçš„ã€‚

----

æ¸¸æˆä¸­æ¯ä¸ªè§’è‰²éƒ½æœ‰è¾¹ç•Œé›†åˆï¼ˆBounding volumesï¼‰ï¼Œå…¶ä»£è¡¨äº†è§’è‰²å®æ—¶å¿«ç…§çš„å¹¶é›†ï¼Œæ¯”å¦‚åŠç§’å†…è¯¥è§’è‰²çš„å…¨éƒ¨`MovementState`çš„æœ€å¤§èŒƒå›´ã€‚å½“ç©å®¶å°„å‡»å…¶ä»–è§’è‰²ï¼Œæ¯”å¦‚å®‰å¨œæ—¶ï¼Œå­å¼¹ä¼šé¦–å…ˆå’Œå®‰å¨œçš„è¾¹ç•Œé›†åˆç›¸äº¤ï¼ˆå³åŸºäºpingå€¼ï¼Œå®‰å¨œå¯èƒ½åœ¨è¾¹ç•Œé›†åˆçš„ä»»ä½•ä¸€å¤„ï¼‰ã€‚å¦‚æœç©å®¶è§’è‰²å’Œå®‰å¨œæ²¡æœ‰ä¹‹é—´æ²¡æœ‰ä»»ä½•éšœç¢ç‰©ï¼ˆå¦‚ç›¾ã€è½¦ã€å¢™ï¼‰ï¼Œé‚£ä¹ˆåªéœ€è¦å€’å›å®‰å¨œçŠ¶æ€å³å¯ã€‚

![alt text](reaper.png)

ä¸Šå›¾ä¸­ç»¿è‰²ä¸ºæ­»ç¥ï¼ˆçœŸæ˜¯æ­»ç¥å—ï¼Ÿï¼‰çš„å®¢æˆ·ç«¯è§†è§’ï¼Œé»„è‰²ä¸ºæœåŠ¡å™¨è§†è§’ã€‚ç»¿è‰²çš„å°ç‚¹ä¸ºå®¢æˆ·ç«¯è®¤ä¸ºå…¶å­å¼¹å‡»ä¸­çš„ä½ç½®ï¼Œä½†è“ç´«è‰²çš„å°çƒæ‰æ˜¯æœåŠ¡å™¨è®¤ä¸ºçœŸæ­£çš„é›†ä¸­ä½ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¾‹å­æ˜¯å®Œå…¨äººé€ çš„ä¾‹å­ã€‚ç¡®å®šæ€§æ˜¯å¾ˆå¯é çš„ï¼Œä¸ºäº†ç¡®è®¤å‘½ä¸­åˆ¤å®šçš„é—®é¢˜ï¼Œå›¢é˜Ÿå°†ä¸¢åŒ…ç‡è®¾åˆ°60%ï¼Œç”¨äº†20åˆ†é’Ÿæ‰æˆåŠŸå¤ç°ã€‚

å› æ­¤ï¼Œå½“pingè¶³å¤Ÿé«˜çš„æ—¶å€™ï¼Œå‘½ä¸­åˆ¤å®šå°±ä¸å†é‚£ä¹ˆæœ‰ç”¨ã€‚å› æ­¤ï¼Œæš´é›ªå°†é˜ˆå€¼è®¾ä¸º220msï¼Œä¸€æ—¦è¶…å‡ºï¼Œå®¢æˆ·ç«¯å°†ä¼šå»¶åä¸€äº›å‘½ä¸­æ•ˆæœï¼Œä¸”ä¸å†é¢„æµ‹ï¼Œè€Œæ˜¯ç­‰å¾…æœåŠ¡å™¨å›åŒ…ç¡®è®¤ã€‚è¿™æ˜¯ä¸ºäº†è®©é‡‡ç”¨å¤–æ’å€¼ï¼ˆextrapolateï¼‰æ–¹æ¡ˆçš„å®¢æˆ·ç«¯ä¸å»åšä¸€äº›ä»¥å¤–çš„äº‹æƒ…ï¼Œæ¯”å¦‚ç©å®¶éƒ½å›åˆ°æ©ä½“åäº†ï¼Œç»“æœè¿˜åœ¨å› ä¸ºä¹‹å‰çš„å°„å‡»è€Œä¸æ–­æ‰è¡€ã€‚

> æ¥ä¸‹æ¥çš„éƒ¨åˆ†æ¯”è¾ƒé€‚åˆç»“åˆè§†é¢‘è§‚çœ‹ï¼ŒåŸè§†é¢‘çº¦39ï¼š38å¤„å¼€å§‹ã€‚
> ä½†è§†é¢‘ä¹ŸæŒºç³Šçš„ã€‚

å½“ping=0æ—¶ï¼Œå®¢æˆ·ç«¯å°†ä¼šå¯¹å¼¹é“ç¢°æ’è¿›è¡Œé¢„æµ‹ï¼Œä½†å‡»ä¸­ç‚¹å’Œè¡€æ¡æ²¡æœ‰é¢„æµ‹ï¼Œéœ€è¦ç­‰å¾…æœåŠ¡å™¨å›åŒ…ã€‚

å½“ping=300msæ—¶ï¼Œç¢°æ’ä¸ä¼šé¢„æµ‹ï¼Œæ­¤æ—¶å°„å‡»çš„ç›®æ ‡æ˜¯é€šè¿‡å¤–æ’å€¼å®ç°çš„ï¼Œå› æ­¤æ˜¾ç„¶è§’è‰²çš„æ˜¾ç¤ºä½ç½®ï¼ˆå®¢æˆ·ç«¯å¤„ï¼‰å’ŒçœŸå®ä½ç½®ï¼ˆæœåŠ¡ç«¯å¤„ï¼‰æ˜¯ä¸ä¸€æ ·çš„ã€‚å½“æ­»ç¥å·¦å³æ¥å›æ™ƒåŠ¨æ—¶ï¼Œå¤–æ’å€¼åŸºæœ¬æ²¡ç”¨ï¼Œè€Œæš´é›ªä¹Ÿæ— èƒ½ä¸ºåŠ›ï¼Œè¿™æ˜¯ç©å®¶çš„ç½‘ç»œé—®é¢˜ã€‚

å½“ping=1000msæ—¶ï¼Œå»¶è¿Ÿå°¤ä¸ºæ˜æ˜¾ï¼ˆå³å…¶ä»–è§’è‰²åœ¨ç©å®¶é¢å‰â€œç¬ç§»â€ï¼‰ã€‚å½“ç„¶ï¼Œå®¢æˆ·ç«¯çš„è¾“å…¥åœ¨åˆ«çš„ç©å®¶è§†è§’é‡Œä»ç„¶æ˜¯ç¡®å®šçš„ã€å¯é¢„æµ‹çš„ï¼Œåªæ˜¯å¤§éƒ¨åˆ†çš„å°„å‡»éƒ½æ²¡å°„ä¸­ã€‚æ‰€ä»¥è§†é¢‘é‡Œéº¦å…‹é›·å¦‚æœæƒ³æ€æ­»ç¥ï¼Œæœ€å¥½çš„åšæ³•åº”è¯¥æ˜¯å¼€å¤§ï¼Œæ¯•ç«Ÿä½ çš„è¾“å…¥æ˜¯ç¡®å®šçš„ã€‚

----

è€Œå½“ping=150msæ—¶ï¼Œå¦‚æœè¿åŠ¨ï¼ˆMovementï¼‰é¢„æµ‹å¤±è´¥ï¼Œé‚£ä¹ˆç›¸åº”çš„ä¹Ÿä¼šé”™è¯¯çš„é¢„æµ‹å‘½ä¸­ï¼ˆHitï¼‰ã€‚

è§†é¢‘ä¸­ï¼Œç¾åœ¨é»‘ç™¾åˆå¼€æªçš„ä¸€ç¬é—´ä¸­åœ¨é»‘ç™¾åˆè„šåº•ä¸‹æ”¾äº†å†°å¢™ï¼ŒæŠ¬é«˜äº†ç™¾åˆçš„å‡†æ˜Ÿã€‚é»‘ç™¾åˆçš„è§†è§’ä¸­ï¼Œç¾å‘å‡ºäº†å—å‡»åé¦ˆï¼Œä¹Ÿé£™äº†è¡€ï¼Œä½†ç¾çš„è¡€æ¡æ²¡æœ‰æ˜¾ç¤ºï¼Œæ‰€ä»¥å®¢æˆ·ç«¯çš„Hit Registrationé”™è¯¯ï¼ŒæœåŠ¡ç«¯æ‹’ç»äº†è¿™ä¸€äº‹ä»¶ã€‚æ‰€ä»¥ï¼Œå…³äºè¿™éƒ¨åˆ†é¢„æµ‹é”™è¯¯çš„è§£å†³æ–¹æ³•ï¼Œä»ç„¶æ˜¯ä»¥æœåŠ¡ç«¯çš„ç‰ˆæœ¬ä¸ºå”¯ä¸€å‡†åˆ™ã€‚

----

ECSç®€åŒ–äº†ç½‘ç»œåŒæ­¥ï¼ˆNetcodeï¼‰é—®é¢˜ã€‚å…¶æ‰€ç”¨åˆ°çš„Systemåªéœ€è¦å…³æ³¨å…·æœ‰`Connection Component`çš„Entityå³å¯ï¼Œå³ç©å®¶è‡ªå·±ã€‚Systemä¹Ÿéœ€è¦çŸ¥é“å“ªäº›Entityéœ€è¦è¢«å€’å›ï¼ˆrewindï¼‰åˆ°è¿›æ”»è€…å°„å‡»çš„é‚£ä¸€å¸§ï¼Œè¿™æ˜¯ç”±`MovementState Component`å†³å®šçš„ã€‚`MovementState`å¯ä»¥åœ¨æ—¶é—´çº¿ä¸Šè¢«å–æ¶ˆï¼ˆscrubï¼‰ï¼ˆå¤§çº¦æ„æ€æ˜¯å®¢æˆ·ç«¯è¢«æœåŠ¡ç«¯çº æ­£ï¼Ÿï¼‰

![alt text](hit_registration_ecs.png)

åœ¨ECSä¸­ï¼Œç”¨äºç½‘ç»œåŒæ­¥çš„Systemå®é™…æ˜¯å¾ˆå°‘çš„ï¼Œä½†å…¶å·²ç»ç®—æ˜¯å®ˆæœ›å…ˆé”‹ä¸­æœ€ä¸ºå¤æ‚çš„é—®é¢˜ä¹‹ä¸€äº†ã€‚`NetworkEvent System`å’Œ`NetworkMessage System`æ˜¯ç½‘ç»œåŒæ­¥çš„æ ¸å¿ƒï¼Œè¿›è¡Œæ¥å—è¾“å…¥å’Œå‘é€è¾“å‡ºè¿™äº›å…¸å‹ç½‘ç»œè¡Œä¸ºã€‚è€Œå’Œæ¸¸æˆç©æ³•ï¼ˆgameplayï¼‰ç›¸å…³çš„ä»…æœ‰3ä¸ªSystemï¼š`MovementState`ï¼Œ`Weapons`ï¼Œ`Statescript`ï¼Œè€Œç›¸å…³çš„Componentä¸ºå›¾ä¸­å³è¾¹æ‰€æ˜¾ç¤ºï¼Œç»å¤§éƒ¨åˆ†éƒ½æ˜¯åªè¯»Componnentï¼Œé™¤äº†ä¸€å°éƒ¨åˆ†ï¼Œå¦‚`ModifyHealthQueue`ã€‚

## Lessons from ECS

### Tuple of Component

ECSçš„`Component Tuple`å®é™…ä¸Šèƒ½å¤Ÿæé†’å¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ªSystemçš„Tupleè¿‡é•¿ï¼Œé‚£ä¹ˆSystemçš„å¤æ‚æ€§å¯èƒ½å°±è¿‡é«˜ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ‹†åˆ†æˆ–ç®€åŒ–ã€‚

å¦å¤–ï¼ŒTupleçš„é™åˆ¶è®©ç¨‹åºå‘˜èƒ½å¤Ÿæå‰çŸ¥é“Systemåº”è¯¥èƒ½è®¿é—®å“ªäº›Stateï¼ŒSystemçš„Componenté›†åˆå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¹¶ä¸”Componentçš„è¯»å†™æ€§ä¹Ÿæ˜¯å·²çŸ¥çš„ï¼Œè¿™æ„å‘³ç€æ•´ä¸ªECSæ¶æ„å¯ä»¥å¾ˆè‡ªç„¶çš„å¤šçº¿ç¨‹åŒ–ã€‚æ¯”å¦‚`Transform Component`è¢«è®¸å¤šSystemè°ƒç”¨ï¼Œä½†åªæœ‰å°‘æ•°Systemä¼šä¿®æ”¹å…¶çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨å®šä¹‰åªéœ€è¦è¯»å…¶æ•°æ®çš„Systemæ‰€éœ€çš„Tupleæ—¶ï¼Œå¯ä»¥å°†å…¶æ ‡ä¸ºåªè¯»ï¼Œè¿™æ ·å°±å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚

### Entity Lifetime

è¿™é‡Œçš„ä¾‹å­å®é™…ä¸Šæ˜¯ä¸ºäº†è¯´æ˜å‡¡äº‹éƒ½æœ‰ä¾‹å¤–ã€‚

å½“æˆ‘ä»¬éœ€è¦åœ¨æ¸¸æˆçš„ä¸€å¸§å†…åˆ›å»ºæ–°çš„Entityï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚æˆ‘ä»¬å¯èƒ½ä¼šæƒ³ç›´æ¥ç”¨æ¨è¿ŸåŸåˆ™ï¼Œå°†Entityçš„åˆ›å»ºå’Œé”€æ¯æ¨è¿Ÿï¼›äº‹å®è¯æ˜æ¨è¿Ÿé”€æ¯ä¸ä¼šå¸¦æ¥é—®é¢˜ï¼Œä½†æ¨è¿Ÿåˆ›å»ºå´æœ‰é—®é¢˜ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬åœ¨System Aåˆ›å»ºäº†ä¸€ä¸ªEntityï¼ˆä½†å»¶è¿Ÿåˆ°å¸§çš„æœ€åæ‰ç”Ÿæˆï¼‰ï¼Œä½†System Bå´éœ€è¦è¿™ä¸ªEntityï¼Œé‚£ä¹ˆå°±åªèƒ½åœ¨ä¸‹ä¸€å¸§æ‰èƒ½ç”¨ä¸Šã€‚è¿™å°±ä¼šå¢åŠ ç¨‹åºå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œå¼•å…¥äº†æ–°çš„å¤æ‚æ€§ã€‚

å› æ­¤ï¼Œå›¢é˜Ÿä¿®æ”¹äº†å®ç°æ–¹å¼ï¼Œè®©Entityèƒ½åœ¨å¸§ä¸­ç›´æ¥åˆ›å»ºã€‚è¯¥æ”¹åŠ¨ç›´åˆ°æ¸¸æˆçš„1.2/1.3ç‰ˆæœ¬è¯¥æ”¹åŠ¨æ‰ç”Ÿæ•ˆã€‚

### Rules of Play

æš´é›ªèŠ±äº†ä¸€å¹´åŠçš„æ—¶é—´æ‰ç¡®ç«‹äº†ECSçš„ç¼–ç¨‹è§„åˆ™ï¼Œç°åœ¨è®©æˆ‘ä»¬å¯¹ä¸Šæ–‡æ‰€è¿°çš„è§„åˆ™è¿›è¡Œæ€»ç»“ï¼š

1. Componentå†…æ²¡æœ‰å‡½æ•°
2. Systemå†…æ²¡æœ‰çŠ¶æ€
3. å°†å…±äº«çš„ä»£ç æ”¾åœ¨Utilityå‡½æ•°
4. å¤æ‚å‰¯ä½œç”¨ï¼ˆComplex side effectï¼‰åº”è¯¥é€šè¿‡æ”¾è¿›Singletom Componentï¼ˆé˜Ÿåˆ—ï¼‰çš„æ–¹å¼æ¨è¿Ÿæ‰§è¡Œ
5. Systemä¹‹é—´ä¸èƒ½ç›¸äº’è°ƒç”¨ã€‚

åœ¨2017å¹´çš„æ¼”è®²ä¸­ï¼Œæš´é›ªæ‰¿è®¤ä»ç„¶æœ‰å¤§é‡ä»£ç ä¸ç¬¦åˆä»¥ä¸Šè§„èŒƒï¼Œè€Œè¿™äº›ä»£ç æ˜¯å¤æ‚æ€§å’Œç»´æŠ¤å·¥ä½œçš„ä¸»è¦æ¥æºã€‚ä½†æš´é›ªä¼¼ä¹ä¸å¤ªå¸Œæœ›å°†è¿™äº›å¤æ‚çš„é—ç•™ä»£ç ç¼–å†™ä¸ºæ–°çš„Systemï¼Œä»–ä»¬å¸Œæœ›è®©ECSå†…çš„ä»£ç å°½å¯èƒ½åœ°ç®€æ´ã€‚å³ECSå†…ä»…ä¿ç•™ä¸»è¦çš„é€»è¾‘ï¼Œè€Œå…·ä½“çš„å®ç°äº¤ç”±è¿™äº›å¤æ‚ä»£ç å®Œæˆã€‚

----

ECSçš„è®¾è®¡ç›®çš„æ˜¯å°†å¤§é‡æ¨¡å—è¿›è¡Œé›†æˆå¹¶è§£è€¦ï¼Œå¾ˆå¤šSystemåŠä¾èµ–çš„Componentæ˜¯å†°å±±çŠ¶çš„ï¼Œè¿™äº›å†°å±±å‹ç»„ä»¶å¯¹å…¶ä»–Systemæš´éœ²çš„æ¥å£å¾ˆå°‘ï¼Œä½†å†…éƒ¨æœ‰å¤§é‡çš„çŠ¶æ€ã€ä»£ç†ï¼ˆproxyï¼‰å’Œæ•°æ®ç»“æ„æ˜¯ECSå±‚æ— æ³•è®¿é—®çš„ã€‚

![alt text](iceberg.png)

> é«˜ç³Šï¼Œæœ‰ä¸ªå¤§æ¦‚å°è±¡å°±è¡Œ

åœ¨çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œè¿™äº›å†°å±±ç›¸å½“æ˜æ˜¾ã€‚å¤§éƒ¨åˆ†Systemå°†ä¼šåœ¨æ¸¸æˆçš„ä¸»çº¿ç¨‹ä¸­å®Œæˆã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰è®¸å¤šçš„å¤šçº¿ç¨‹ï¼ˆå¦‚fork/joinï¼‰ï¼Œæ¯”å¦‚æœ‰è§’è‰²å‘å°„äº†å¤§é‡æŠ›å°„ç‰©ï¼ŒScript Systemå°†ä¼šåˆ›å»ºå¤šä¸ªå·¥ä½œçº¿ç¨‹æ¥ç”ŸæˆæŠ›å°„ç‰©ï¼Œå…¶ä»–Systemå¯èƒ½æƒ³åˆ›å»ºç¢°æ’ç‰¹æ•ˆï¼ŒåŒæ ·éœ€è¦å¤šä¸ªå·¥ä½œçº¿ç¨‹ã€‚è¿™äº›å·¥ä½œçº¿ç¨‹å¯¹ä¸Šå±‚ECSæ˜¯ä¸å¯è§çš„ã€‚

è§†é¢‘ä¸­ä»¥é˜¿åŠªæ¯”æ–¯ç¥åº™å‡ºç”Ÿç‚¹çš„ç¦…é›…å¡”ä¸ºä¾‹ï¼Œè¯´æ˜`PathValidationSystem`çš„ä½œç”¨ã€‚è¯¥Systemå°†ä¼šéªŒè¯å½“å‰æ—¶åˆ»è§’è‰²å¯¹å…¶ä»–åœºæ™¯çš„å¯è¾¾æ€§ï¼Œè¿™ä¸€Systemä¹Ÿç”¨äºè®¸å¤šè‹±é›„çš„æŠ€èƒ½ä¸Šï¼ˆç±»æ¯”çš„è¯å°±åƒOW2é›¾å­çš„çµç‹ï¼Œå¦‚æœäººèƒ½èµ°è¿‡å»é‚£ä¹ˆçµç‹ä¹Ÿèƒ½èµ°è¿‡å»ï¼Œå› æ­¤äº›è®¸çš„å°é˜¶æ˜¯ä¸å½±å“çµç‹ç¿»è¿‡å»çš„ï¼‰

ç¦…é›…å¡”å¯ä»¥ç ´åå‡ºç”Ÿç‚¹çš„è„šæ‰‹æ¶ï¼Œé‚£ä¹ˆPathå°±ä¼šæ›´æ–°ã€‚ç±»ä¼¼çš„ï¼Œå½“æ¸¸æˆæ­£å¼å¼€å§‹æ—¶ï¼Œå‡ºç”Ÿç‚¹çš„é—¨ä¼šé™ä¸‹ï¼Œ`PathValidationSystem Hook`åªéœ€è¦å‘Šè¯‰ç»„ä»¶â€œå˜¿ï¼Œä¸‰è§’å½¢å˜åŒ–äº†â€ï¼Œç»„ä»¶èƒŒåçš„å†°å±±å°±ä¼šå¼€å§‹é‡å»ºPathã€‚

## Summary and Question

çºµè§‚å…¨æ–‡ï¼ŒECSå®é™…ä¸Šæ›´åƒæ˜¯èƒ¶æ°´ï¼Œå°†å®ˆæœ›å…ˆé”‹å„ä¸ªéƒ¨åˆ†é€šè¿‡ECSé›†æˆèµ·æ¥ï¼Œå´ä¿ç•™äº†æœ€å°çš„è€¦åˆæ€§ã€‚ç¨‹åºå‘˜æ— éœ€å…³æ³¨åº•å±‚ç‰©ç†å¼•æ“ã€è„šæœ¬å¼•æ“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œåªéœ€è¦é€šè¿‡ECSç¼–å†™èƒ¶æ°´ä»£ç å°±è¡Œäº†ã€‚

> Q: æ˜¯å¦å¯ä»¥è®©Componentæœ‰å‰¯æœ¬ï¼Ÿæ¯”å¦‚æˆ‘åœ¨ç¬¬nå¸§ä¸Šç»´æŠ¤ä¸€ä¸ªComponentï¼Œç¬¬n+1å¸§ç»´æŠ¤å®ƒçš„å‰¯æœ¬ï¼Œè¿™æ ·æˆ‘å¯ä»¥éšæ„ä¿®æ”¹è¿™ä¸ªå‰¯æœ¬ï¼Œè€Œä¸ä¿®æ”¹åŸå…ˆç¬¬nå¸§çš„Componentã€‚

A: è¿™ç§Double bufferçš„æ–¹æ¡ˆå¯¹å¤šçº¿ç¨‹çš„ä¼˜åŒ–æ˜¯å¾ˆå¥½çš„ï¼Œä¹Ÿå¾ˆå®¹æ˜“åœ¨ECSä¸­å®ç°ã€‚å®é™…ä¸Šæš´é›ªä¹Ÿå¼€å‘è¿‡è¿™ç§Double bufferçš„ECS åŸå‹ã€‚è¿™ç§ä¼˜åŒ–åœ¨æŸäº›Systemæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†åœ¨æœ‰è®¸å¤šç‰©ä½“äº¤äº’çš„Systemä¸­ï¼Œè¿™ä¼šå¯¼è‡´ä¸€å¸§çš„å»¶è¿Ÿï¼Œä»è€Œæœ‰æŸå®ˆæœ›å…ˆé”‹çš„å³æ—¶æ€§ï¼ˆresponsivenessï¼‰ã€‚

----

> Q: ä¸ºä»€ä¹ˆå­å¼¹ï¼ˆå³å‰æ–‡æåˆ°çš„æŠ›å°„ç‰©ï¼‰çš„æ•Œå¯¹å…³ç³»æ˜¯æ ¹æ®å­å¼¹çš„æ‹¥æœ‰è€…æ¥åˆ¤å®šçš„ï¼Ÿæ¯”å¦‚æ³•é¸¡å‘å°„äº†ä¸€æšç«ç®­ï¼Œåœ¨ç«ç®­é£è¡Œçš„æ—¶å€™æ³•é¸¡æ”¹é˜Ÿäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªç«ç®­å°±å¯ä»¥å‡»ä¼¤æ³•é¸¡åŸå…ˆçš„é˜Ÿå‹ã€‚ä¸ºä»€ä¹ˆä¸åœ¨å­å¼¹Entityå†…å­˜æ•Œå¯¹æ•°æ®ï¼Ÿ

Aï¼šè¿™å½“ç„¶æ˜¯ä¸€ç§å®ç°æ–¹å¼ï¼Œä½†æºæ°æ”¹å˜äº†è¿™ä¸€åˆ‡ã€‚æºæ°çš„Eæ˜¯å¯ä»¥åå¼¹åˆ«äººå­å¼¹çš„ï¼Œæ‰€ä»¥æ³•é¸¡å‘å°„ç«ç®­ï¼Œæºæ°åå¼¹å›å»ï¼Œåœ¨å…·ä½“çš„ä»£ç å®ç°ä¸­ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨ä½ æ‰€è¯´çš„æ–¹å¼ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨å­å¼¹Entityä¸­ä¿®æ”¹ä¸€ç³»åˆ—æ•°æ®ã€‚ä½†å¦‚æœç®€å•åœ°ä¿®æ”¹å­å¼¹çš„æ‹¥æœ‰è€…ï¼Œä¼šè®©ä»£ç æ›´åŠ ç®€å•ã€‚

(æ³¨ï¼šå®é™…ä¸Šç›®å‰çš„å®ç°ä¸­ï¼Œç©å®¶åªè¦æ”¹äº†é˜Ÿä¼æˆ–è€…æ”¹äº†è‹±é›„ï¼ŒåŸæ¥è‹±é›„åˆ›å»ºçš„å®ä½“å°±ä¼šæ¶ˆå¤±ï¼Œæ‰€ä»¥è¯¥é—®é¢˜å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ã€‚)

----

> Qï¼šä½ æåˆ°äº†ä½ ä»¬èŠ±äº†ä¸‰å¹´å»å»ºç«‹ECSçš„ç¼–ç¨‹è§„èŒƒï¼Œé‚£ä½ ä»¬æ˜¯å¦‚ä½•é‡æ„ä¹‹å‰å¼€å‘çš„Systemçš„ï¼Ÿ

Aï¼š æˆ‘ä»¬å°†æˆ‘ä»¬å¸Œæœ›é‡æ„çš„ä»£ç å°å­˜ï¼Œé‡å†™å®Œå†ä¸¢æ‰ï¼ˆç¬‘å£°ï¼‰ã€‚ECSçš„æ¨¡å—å¼å¼€å‘è®©æˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½å¤Ÿé‡å†™æ•´ä¸ªSystemã€‚æˆ‘ä»¬ä¼šå› ä¸ºå„ç§å„æ ·çš„åŸå› å»è¿­ä»£é‡å†™Systemï¼Œè€Œä¸æ˜¯é‡æ„å¤ç”¨åŸæ¥çš„ä»£ç ã€‚æ‰€ä»¥ä½ çœ‹ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ²¡åšä»€ä¹ˆæˆç†Ÿè½¯ä»¶å·¥ç¨‹åº”è¯¥åšçš„äº‹ã€‚ï¼ˆç¬‘å£°ï¼‰

----

> Qï¼šä½ æåˆ°äº†åˆ›å»ºEntityæ— æ³•åº”ç”¨Defermentï¼Œèƒ½ä¸èƒ½é€šè¿‡ä¸€äº›æ›´å¥½çš„æ–¹å¼ï¼Œè®©entityåœ¨å¸§æ‰§è¡Œçš„è¿‡ç¨‹ä¸­åˆ›å»ºï¼Œä»è€Œé¿å…æ— Defermentå¸¦æ¥çš„é—®é¢˜ï¼Ÿ

Aï¼šè¿™é‡Œçš„é—®é¢˜å°±æ˜¯Defermentæƒ³è¦è§£å†³çš„é—®é¢˜ä¹‹ä¸€ã€‚å¦‚æœå¸§æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ›å»ºEntityï¼Œä¸€ç§å®ç°æ–¹å¼æ˜¯å¼‚æ­¥åˆ›å»ºä¸€å°éƒ¨åˆ†Entityï¼Œå°†è¿™äº›Componentæ¥åˆ°ä¹‹å‰æˆ‘ä»¬æåˆ°çš„Componentè¿­ä»£å™¨åé¢ã€‚è¿™å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†è¿™å°†Component iteratoråˆ†ä¸ºäº†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯local arrayï¼Œå­˜å–é€Ÿåº¦æå¿«ï¼›å¦ä¸€éƒ¨åˆ†æ˜¯æ­£åœ¨å¼‚æ­¥ç”Ÿæˆçš„Componentï¼Œè¿™ä¼šå¸¦æ¥æ€§èƒ½çš„æŸå¤±ã€‚

----

> Qï¼šServerå’ŒClientéƒ½å›ºå®šåœ¨60å¸§æ¯ç§’ï¼Œå¸§ç‡èƒ½å¦æ”¹å˜å‘¢ï¼Ÿ

Aï¼šå¸§ç‡æ˜¯ä¸å¯å˜çš„ã€‚å¯ä»¥ä¸æŒ‰60å¸§æ¸²æŸ“ï¼Œä½†å®é™…çš„æ¸¸æˆè¿‡ç¨‹éœ€è¦60å¸§ã€‚å¦‚æœä½ çš„ç”µè„‘åªèƒ½æ”¯æŒ30å¸§çš„æ¨¡æ‹Ÿï¼ŒServeræ˜¯60å¸§ï¼Œé‚£ä¹ˆä½ åœ¨æ¯ä¸€å¸§éƒ½ä¼šè½ååˆ«äºº16msï¼Œè¿™æ˜¯ä¸€ä¸ªæ­»äº¡èºæ—‹ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸å¯è¡Œçš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¼šå°½åŠ›ä¼˜åŒ–æ¸¸æˆçš„å¸§ç‡ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µå¾ˆéš¾å‘ç”Ÿã€‚

(æ³¨ï¼šæ„Ÿè§‰ç­”éæ‰€é—®ã€‚Overwatchåˆšæ¨å‡ºæ—¶çš„rateä¸º24 ticks/sï¼Œä¹‹åä¿®æ”¹ä¸º60 ticks/sï¼Œæ‰€ä»¥åœ¨å®é™…çš„æƒ…å†µä¸‹ï¼Œæš´é›ªæ˜¯èƒ½ä¿®æ”¹server/clientçš„tick rateçš„ã€‚å¦å¤–ï¼Œæ®è¯´Overwatchå¹¶æ²¡æœ‰åˆ‡æ¢åˆ°120rateçš„æ‰“ç®—ã€‚)

----

> Qï¼šä½ æåˆ°äº†hit predictionã€‚ä½ ä»¬ä¹Ÿå°†å…¶ç”¨åœ¨æ…¢é€Ÿçš„Entityï¼Œæ¯”å¦‚æ³•é¸¡çš„ç«ç®­äº†å—ï¼Ÿ

Aï¼šåœ¨æˆ‘ä»¬ä¹‹å‰çš„FPSéƒ½æ²¡æœ‰å¯¹è¯¸å¦‚ç«ç®­çš„æ…¢é€Ÿå­å¼¹è¿›è¡Œpredictionã€‚ä½†æˆ‘ä»¬æœ€ç»ˆå®ç°äº†ä»–ï¼Œè¿™å¸¦æ¥äº†ä¸€äº›å¥‡æ€ªçš„å‰¯ä½œç”¨ï¼Œæ¯”å¦‚ç«ç®­çš„å®é™…è¿è¡Œå¹¶ä¸åƒç©å®¶æ‰€çœ‹åˆ°çš„ä¸€æ ·æ˜¯æ¡ç›´çº¿ï¼Œå¯èƒ½ä¼šå› ä¸ºé¢„æµ‹é”™è¯¯è€Œæ¶ˆå¤±ã€‚æ¯”å¦‚ç©å®¶æ“çºµçš„æ³•é¸¡å‘å°„ç«ç®­æ—¶è¢«éº¦å…‹é›·é—ªå…‰å¼¹æ™•äº†ï¼Œç«ç®­å°±å¯èƒ½æ¶ˆå¤±ã€‚ä½†æˆ‘ä»¬åšæŒè®¤ä¸ºå¯¹å…¶è¿›è¡Œhit predictionæ˜¯æ­£ç¡®çš„ã€‚

----

> Qï¼šSpatial Quantizationæ˜¯æ€ä¹ˆå½±å“ä½ ä»¬çš„ç‰©ç†å¼•æ“çš„ï¼Ÿ

Aï¼šè¿™æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ï¼Œåœ¨ä¸åŒçš„å¹³å°ä¸Šç¼–è¯‘å‡ºæ¥çš„OverwatchæŒ‡ä»¤é¡ºåºæœ‰å¯èƒ½ä¸åŒï¼Œæµ®ç‚¹æ•°çš„å¤„ç†æ–¹å¼ä¹Ÿå¯èƒ½ä¸åŒï¼Œè¿™å¯èƒ½ä¼šå½±å“ç©å®¶çš„ä½“éªŒï¼Œä¸è¿‡è¿™æ˜¯æ˜å¤©ä¸»è®²äººæ‰€è®²çš„å†…å®¹ï¼ˆæ³¨ï¼šå¯¹ï¼Œæˆ‘è¿˜è¦ç¿»è¯‘è¿™ä¸ªğŸ˜­ï¼‰ã€‚

> Q: é‚£ä½ ä»¬æ˜¯å¦‚ä½•ä¿è¯ä¸åŒå¹³å°ä¸Šçš„Determinismçš„ï¼Ÿ

Aï¼šæˆ‘ä»¬å¹¶æ²¡æœ‰å®ç°å®Œå…¨çš„ã€åƒRTSé‚£æ ·çš„Determinismã€‚æˆ‘ä»¬çš„Determinismèƒ½å¤Ÿåšåˆ°æ²¡æœ‰é”™è¯¯çš„é¢„æµ‹ï¼ˆå³å…·æœ‰çº é”™èƒ½åŠ›ï¼‰ã€‚å¦‚æœåœ¨å…¶ä»–åœ°æ–¹å‘ç”Ÿäº†ä¸ä¸€è‡´ï¼Œæ¯”å¦‚ç”±äºé—¨æ‰“å¼€å¯¼è‡´çš„NavMeshå˜åŠ¨ï¼Œä¸åŒClientä¼šå› ä¸ºç½‘ç»œå»¶è¿Ÿçš„é—®é¢˜ä¸ä¸€è‡´ï¼ŒServerçš„æƒå¨å‰¯æœ¬å¯ä»¥å°†ä¸ä¸€è‡´çš„Clientçº æ­£ä¸ºServerçš„çŠ¶æ€ã€‚
